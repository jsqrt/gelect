class Gelect{get CLASSNAMES(){return this.wrapper="gelect",this.trigger=`${this.settings.class}_selected`,this.dropdown=`${this.settings.class}_dropdown`,this.searchField=`${this.settings.class}_search_wrap`,this.searchClose=`${this.settings.class}_search_close`,this.search=`${this.settings.class}_search`,this.list=`${this.settings.class}_options`,this.listItem=`${this.list}__item`,this.option=`${this.list}__btn`,this.hiddenSelect=`${this.settings.class}_hidden`,this}constructor(t,e){this.$defaultSelect=t,this.$defaultSelect&&"SELECT"===this.$defaultSelect.tagName&&(this.$root=this.$defaultSelect.parentElement,this.$defaultOptions=this.$defaultSelect.querySelectorAll("option"),this.$options=[],this.isDropdownActive=!1,this.settings={class:this.$defaultSelect.classList[0]||this.CLASSNAMES.wrapper,placeholder:this.$defaultSelect.dataset.placeholder,search:this.$defaultSelect.dataset.search,ariaMessage:this.$defaultSelect.dataset.ariaMessage,ariaLabel:this.$defaultSelect.getAttribute("aria-label"),beforeChange:null,afterChange:null,onClick:null,onOpen:null,onClose:null,onInit:null,onSearch:null},Object.assign(this.settings,e),this.init())}init(){this.defineNodes(),this.defineOptions(),this.defineDefaultStates(),this.initEvents(),this.settings.onInit&&this.settings.onInit(this)}copyAttributes(t,e){Object.keys(t.attributes).forEach(s=>{t.attributes[s].nodeName&&e.setAttribute(t.attributes[s].nodeName,t.attributes[s].nodeValue)})}defineNodes(){this.wrapperInit(),this.triggerInit(),this.hiddenSelectInit(),this.dropdownInit(),this.$defaultOptions&&(this.listInit(),this.$dropdown.append(this.$list)),this.settings.search&&this.$dropdown.prepend(this.separateSeachInit()),this.$wrapper.append(this.$trigger),this.$wrapper.append(this.$dropdown),this.$wrapper.prepend(this.$hiddenSelect),this.$root.append(this.$wrapper),this.$defaultSelect.remove()}wrapperInit(){this.$wrapper=document.createElement("div"),this.$wrapper.classList.add(this.settings.class),this.$wrapper.dataset.state="hidden",this.$wrapper.setAttribute("role","listbox"),this.copyAttributes(this.$defaultSelect,this.$wrapper),this.settings.ariaLabel?this.$wrapper.setAttribute("aria-label",this.settings.ariaLabel):this.$wrapper.setAttribute("aria-label",this.settings.placeholder)}triggerInit(){this.$trigger=document.createElement("button"),this.$trigger.classList.add(this.CLASSNAMES.trigger),this.$trigger.setAttribute("type","button"),this.$trigger.setAttribute("role","status"),this.$trigger.setAttribute("aria-live","polite")}dropdownInit(){this.$dropdown=document.createElement("div"),this.$dropdown.classList.add(this.CLASSNAMES.dropdown)}listInit(){this.$list=document.createElement("ul"),this.$list.classList.add(this.CLASSNAMES.list)}separateSeachInit(){return this.$searchField=document.createElement("div"),this.$searchField.classList.add(this.CLASSNAMES.searchField),this.$search=document.createElement("input"),this.$search.classList.add(this.CLASSNAMES.search),this.$search.setAttribute("type","search"),this.$search.setAttribute("placeholder","search"),this.$search.setAttribute("placeholder",this.settings.search.placeholder||this.$defaultSelect.dataset.searchPlaceholder||"Search..."),this.$searchClose=document.createElement("button"),this.$searchClose.classList.add(this.CLASSNAMES.searchClose),this.$searchClose.setAttribute("type","button"),this.$searchClose.setAttribute("aria-label","Ð¡lear the field"),this.$searchClose.setAttribute("tabindex","-1"),this.$searchClose.setAttribute("aria-hidden","true"),this.$searchField.append(this.$search),this.$searchField.append(this.$searchClose),this.$searchField}hiddenSelectInit(){this.$hiddenSelect=document.createElement("select"),this.$hiddenOption=document.createElement("option"),this.$hiddenSelect.classList.add(this.CLASSNAMES.hiddenSelect),this.$hiddenSelect.append(this.$hiddenOption)}defineOptions(){this.$defaultOptions&&this.$defaultOptions.forEach((t,e)=>{let s=document.createElement("li"),i=document.createElement("button");s.classList.add(this.CLASSNAMES.listItem),this.copyAttributes(t,i),i.removeAttribute("data-selected"),i.classList.add(this.CLASSNAMES.option),i.textContent=t.textContent,i.setAttribute("role","option"),i.setAttribute("aria-selected","false"),i.addEventListener("click",t=>{this.handleChangeSelected(t),this.dropdownClose()}),s.append(i),this.$list.append(s),this.$options.push(i),!t.dataset.selected||this.settings.$selectedOption||this.settings.placeholder?0===e&&(this.$firstOption=i):this.setSelected(i)})}setTriggerAria(){this.$wrapper.dataset.ariaMessage&&this.$wrapper.setAttribute("aria-label",`${this.$wrapper.dataset.ariaMessage} ${this.$trigger.textContent}`)}setValue(t){this.$trigger.textContent=t}setSelected(t){this.settings.$selectedOption&&(this.settings.$selectedOption.parentElement.removeAttribute("data-selected"),this.settings.$selectedOption.removeAttribute("tabindex"),this.settings.$selectedOption.setAttribute("aria-selected","false")),this.settings.$selectedOption=t,this.settings.$selectedOption.parentElement.dataset.selected="true",this.settings.$selectedOption.setAttribute("tabindex","-1"),this.settings.$selectedOption.setAttribute("aria-selected","true"),this.$hiddenOption.textContent=this.settings.$selectedOption.textContent,this.$hiddenOption.setAttribute("value",this.settings.$selectedOption.textContent),this.setValue(this.settings.$selectedOption.textContent),this.setTriggerAria()}defineDefaultStates(){this.settings.placeholder?this.setValue(this.settings.placeholder):this.settings.$selectedOption||(this.settings.$selectedOption=this.$firstOption,this.setSelected(this.$firstOption)),this.isDropdownActive&&this.dropdownOpen(),this.$search&&(this.searchingState=!1)}initEvents(){this.handleOutsideClick=this.handleOutsideClick.bind(this),this.onHandleTriggerClick(),this.$search&&(this.handleSearch=this.handleSearch.bind(this),this.clearSearch=this.clearSearch.bind(this))}dropdownOpen(){this.settings.onOpen&&this.settings.onOpen(this),this.isDropdownActive=!0,this.$wrapper.dataset.state="active",window.addEventListener("click",this.handleOutsideClick),this.$search&&(this.$search.addEventListener("input",this.handleSearch),this.$searchClose.addEventListener("click",this.clearSearch))}dropdownClose(){this.settings.onClose&&this.settings.onClose(this),this.isDropdownActive=!1,this.$wrapper.dataset.state="hidden",window.removeEventListener("click",this.handleOutsideClick),this.$search&&(this.clearSearch(),this.$search.removeEventListener("input",this.handleSearch),this.$searchClose.removeEventListener("click",this.clearSearch))}handleChangeSelected(t){this.settings.beforeChange&&this.settings.beforeChange(this),this.setSelected(t.target),this.$trigger.focus(),this.$search&&this.clearSearch(),this.settings.afterChange&&this.settings.afterChange(this)}onHandleTriggerClick(){this.$trigger.addEventListener("click",()=>{this.settings.onClick&&this.settings.onClick(this),this.isDropdownActive?this.dropdownClose():this.dropdownOpen()})}handleOutsideClick(t){this.isDropdownActive&&!this.$wrapper.contains(t.target)&&this.dropdownClose()}clearSearch(){this.searchingState&&(this.searchingState=!1,this.$wrapper.removeAttribute("data-searching"),this.$searchClose.setAttribute("aria-hidden","true"),this.$searchClose.setAttribute("tabindex","-1"),this.$search.value="",this.$options.forEach(t=>{t.style.display="block"}))}handleSearch(t){let{value:e}=t.target;this.settings.onSearch&&this.settings.onSearch(t,this),""!==e?(this.searchingState=!0,this.$wrapper.setAttribute("data-searching","true"),this.$searchClose.removeAttribute("aria-hidden"),this.$searchClose.removeAttribute("tabindex"),this.$options.forEach(t=>{const s=t;t.textContent.toLowerCase().includes(e.toLowerCase())?s.style.display="block":s.style.display="none"})):this.clearSearch()}}export default Gelect;